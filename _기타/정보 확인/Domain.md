## NetGetJoinInformation

### Concept

랜섬웨어가 로컬 컴퓨터가 속한 도메인을 파악하는 경우가 존재

### NetGetJoinInformation

```c++
NET_API_STATUS NET_API_FUNCTION NetGetJoinInformation(
  [in]  LPCWSTR               lpServer,
  [out] LPWSTR                *lpNameBuffer,
  [out] PNETSETUP_JOIN_STATUS BufferType
);
```

### NETSETUP_JOIN_STATUS

```c++
typedef enum _NETSETUP_JOIN_STATUS {
    NetSetupUnknownStatus = 0,
    NetSetupUnjoined,
    NetSetupWorkgroupName,
    NetSetupDomainName
} NETSETUP_JOIN_STATUS, *PNETSETUP_JOIN_STATUS;
```

### Example

```c++
NetGetJoinInformation(NULL, domain_name_ptr, &buffer_type);
```


## DsGetDcNameW

### Concept

도메인 컨트롤러 정보에서 도메인 이름을 획득하는 방식

### DsGetDcNameW

```c++
DSGETDCAPI DWORD DsGetDcNameW(
  [in]  LPCWSTR                  ComputerName,
  [in]  LPCWSTR                  DomainName,
  [in]  GUID                     *DomainGuid,
  [in]  LPCWSTR                  SiteName,
  [in]  ULONG                    Flags,
  [out] PDOMAIN_CONTROLLER_INFOW *DomainControllerInfo
);
```

### DOMAIN_CONTROLLER_INFOW

```c++
typedef struct _DOMAIN_CONTROLLER_INFOA {
  LPSTR DomainControllerName;
  LPSTR DomainControllerAddress;
  ULONG DomainControllerAddressType;
  GUID  DomainGuid;
  LPSTR DomainName;
  LPSTR DnsForestName;
  ULONG Flags;
  LPSTR DcSiteName;
  LPSTR ClientSiteName;
} DOMAIN_CONTROLLER_INFOA, *PDOMAIN_CONTROLLER_INFOA;
```

### Example

```c++
DOMAIN_CONTROLLER_INFOW *p_dci;

DsGetDcNameW(0x0, 0x0, 0x0, 0x0, 0x0, &p_dci);
wcscpy(domain_name, p_dci->DomainName);
NetApiBufferFree(p_dci);
```