### Concept

악성 코드는 감염된 시스템의 환경 정보를 획득하기 위해 Drive 정보를 수집.
랜섬웨어가 시스템을 암호화시키는 과정에서 Drive 정보를 수집.


### GetLogicalDriveStringsW

``` c++
DWORD GetLogicalDriveStringsW(
  [in]  DWORD  nBufferLength,
  [out] LPWSTR lpBuffer
);
```

lpBuffer 내의 drive string들은 null로 구분되며, 맨 마지막은 null 2개로 구성됨.
반환 값은 마지막 null 2개를 제외한 Buffer의 길이임.

### GetDriveTypeW

```c++
UINT GetDriveTypeW(
  [in, optional] LPCWSTR lpRootPathName
);
```


### GetDiskFreeSpaceExW

```c++
BOOL GetDiskFreeSpaceExW(
  [in, optional]  LPCWSTR         lpDirectoryName,
  [out, optional] PULARGE_INTEGER lpFreeBytesAvailableToCaller,
  [out, optional] PULARGE_INTEGER lpTotalNumberOfBytes,
  [out, optional] PULARGE_INTEGER lpTotalNumberOfFreeBytes
);
```


### CodeFlow

1. GetLogicalDriveStringsW를 호출하여 DriveStrings 획득
2. 획득한 DriveStrings를 순회하며 GetDriveTypeW을 호출하여 DriveType을 체크
3. 확인하고자 하는 DriveStrings을 사용하여 GetDiskFreeSpaceExW를 호출하여 정보 획득


### Example

```c++
bufLen = GetLogicalDriveStringsW(0, NULL);
bufPtr = (wchar_t *)malloc(bufLen * sizeof(wchar_t));
bufLen = GetLogicalDriveStringsW(bufLen, bufPtr);

p = bufPtr;
while (*p) {
	type = GetDriveTypeW(p);
	if (type == DRIVE_FIXED || type == DRIVE_REMOVABLE || type == DRIVE_REMOTE) {
		GetDiskFreeSpaceExW(p, null, total_number_of_bytes, total_number_of_free_bytes);
		// 정보 처리
	}
	p += wcslen(p) + 1;
}

if (bufPtr) {
	free(bufPtr);
}
```