## 코드 스테핑 기반 탐지

프로세스를 디버깅할 때는 명령어를 한 단계씩 실행하는 코드 스테핑으로 인해 두 명령어 사이에 지연 시간이 발생함. 멀웨어는 명령어 사이의 지연 시간을 비교해 디버깅을 감지할 수 있음.

### 지연시간 기반 탐지

RTDSC 명령어는 시스템이 부팅된 이후 얼마나 시간이 알려줌. 멀웨어는 두 명령어의 시간차이를 계산해 임계치와 비교하는 방식으로 프로세스가 디버깅 중임을 알 수 있음. GetTickCount API, QueryPerformanceCounter API와 같은 API를 사용하는 방법도 존재.

### Trap Flag 기반 탐지

디버거는 코드를 한 단계씩 실행하기 위해 EFLAGS 레지스터의 TF, Trap Flag를 설정하고 각 명령어 실행 후 발생하는 예외를 처리함. 멀웨어는 Exception Handler를 삽입한 후, EFLAGS 레지스터의 TF 비트를 설정함. 코드가 실행될 때 멀웨어의 Exception Handler가 호출되면 프로세스는 디버깅 중이지 않음을 의미하고, Exception Handler가 호출되지 않으면 프로세스는 디버깅 중이라는 의미임. 

