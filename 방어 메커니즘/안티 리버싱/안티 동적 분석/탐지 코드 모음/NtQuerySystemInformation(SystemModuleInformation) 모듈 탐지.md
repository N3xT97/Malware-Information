### Description

멀웨어는 NtQuerySystemInformation API에 SystemModuleInformation(0xb)를 전달하여 시스템 모듈을 조사하여 자신이 분석 환경에서 실행 중인지 확인. NextEntryOffset 통해 구조체를 순회하면서 Name을 검사하여 관련 모듈이 실행 중인지 확인.

### 관련 API

- NtQuerySystemInformation

### 예제 코드

```C++
NtQuerySystemInformation(SystemModuleInformation, NULL, 0x0, &ReturnLength);
ReturnLength = ReturnLength + 0x1000;
pSMI = LocalAlloc(0x40,ReturnLength);
// SYSTEM_MODULE_INFORMATION 구조체 내에 SYSTEM_MODULE 구조체로된 배열이 존재
NtQuerySystemInformation(SystemModuleInformation, pSMI, ReturnLength, &ReturnLength);
nModules = pSMI->ModulesCount;
pSM = pSMI->Modules;
// SM 구조체들을 순회하면서 Module Name이 Sandbox 관련 모듈인지 확인
for (; nModules != 0x0; nModules = nModules - 0x1) {
	// ModuleNameOffset = ImageName이 가르키는 FullPath에서 경로를 제외한 Name의 시작 오프셋
    // ImageName = Module의 FullPath
	res = check_module(pSM->Name + pSM->NameOffset)
	if (res == 0x0) {
		break;
	}
	pSM = pSM + 0x1;
}
```
