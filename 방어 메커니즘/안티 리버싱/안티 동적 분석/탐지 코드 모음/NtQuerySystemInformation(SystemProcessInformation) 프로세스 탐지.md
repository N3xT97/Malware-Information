### Description

멀웨어는 NtQuerySystemInformation API에 SystemProcessInformation(0x5)를 전달하여 시스템 프로세스을 조사하여 자신이 분석 환경에서 실행 중인지 확인. NextEntryOffset 통해 구조체를 순회하면서 ImageName을 검사하여 관련 프로세스가 실행 중인지 확인.

### 관련 API

- NtQuerySystemInformation

### 예제 코드

```C++
// SYSTEM_MODULE_INFORMATION 구조체 크기 확인 및 메모리 할당
SYSTEM_MODULE_INFORMATION *pSMI;
NtQuerySystemInformation(SystemProcessInformation,NULL,0x0,&ReturnLength);
ReturnLength = ReturnLength + 0x1000;
pSPI = (SYSTEM_PROCESS_INFORMATION *)LocalAlloc(0x40, ReturnLength);

// SYSTEM_MODULE_INFORMATION 정보 획득
NtQuerySystemInformation(SystemProcessInformation,pSPI,ReturnLength,&ReturnLength);

// 반복문을 통한 ImageName 체크
for (; pSPI->NextEntryOffset != 0x0; pSPI = pSPI->NextEntryOffset) {
      pProcessNameW = (pSPI->ImageName).Buffer;
      make_strW_lower(pProcessNameW);
			for (i = 0; g_VM_PROCESS_LIST[i] = NULL; i++) {
					find = wcsstr(pProcessNameW,g_VM_PROCESS_LIST[i])
					if (find !=  0) {
						// IsVM = true
					}
			}
}
```
