## docx

- Microsoft Word에서 만든 문서를 만들고 저장하는 데 사용되는 파일 형식
- Microsoft Word 버전 2007 이상의 기본 파일 형식이며 이전 DOC 파일 형식을 대체
- ML과 ZIP 압축이 결합된 Open XML 파일 형식을 기반
- 압축 해제를 통해 내부 내용을 확인할 수 있음.
	
	![399](images/docx/IMG-docx-20240818160225037.png)
	

### \\word\\media\\

- 악성 코드에서는 정상적인 파일로 보이게 하기 위해 이미지를 활용하는 경우가 존재
	
	![399](images/docx/IMG-docx-20240818160225830.png)
	
- 해당 폴더에서는 docx 파일에 사용된 image를 확인 가능
	
	![439](images/docx/IMG-docx-20240818160225892.png)
	

### \\word\\\_rels\\settings.xml.rels

- 공격자는 settings.xml.rels 내의 Target 중 하나를 Injection 하고자하는 파일의 위치로 변경.
	
	![556](images/docx/IMG-docx-20240818160226339.png)
	


## Attacks

### Template Injection

1. 사용자가 문서 파일을 실행
2. 외부에서 공격자가 설정한 .dotm 파일이 다운로드됨. (Template Injection)
3. .dotm 파일은 일반적으로 VBA 매크로에 의해 악성 코드를 다운로드하고 실행.


## Analysis

### Template Injection

1. oleid를 사용하여 .docx 파일을 분석
	- External Relations의 Risk가 HIGH이면 Tamplate Injection을 의심해봐야 함.
	
	```POWERSHELL
	oleid <filename>
	```
	
	![531](images/docx/IMG-docx-20240818160226403.png)
	

2. oleobj를 사용하여 External Relationships 확인
	
	```
	oleobj <filename>
	```
	
	![584](images/docx/IMG-docx-20240818160226814.png)
	

3. 공격자가 Injection 하고자하는 .dotm 파일 다운로드
	
	```POWERSHELL
	Invoke-WebRequest -Uri <src> -OutFile <dst>
	```
	

4. oleid를 사용하여 .dotm 파일을 분석
	- VBA Macros의 Risk가 HIGH면, 악성 코드임을 의심해 봐야함.
	
	![531](images/docx/IMG-docx-20240818160226884.png)
	

5. olevba를 사용하여 vba 매크로 확인
	
	![531](images/docx/IMG-docx-20240818160227282.png)
	