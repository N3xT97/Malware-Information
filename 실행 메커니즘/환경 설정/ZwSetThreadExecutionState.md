### Concept

악성 코드는 SetThreadExecutionState API를 사용하여 필요한 스레드의 실행 요구 사항을 설정

### Code Flow

1. 필요한 실행 요구 사항을 Flags로 생성
2. SetThreadExecutionState API를 호출하여 Flags를 전달

### SetThreadExecutionState

```c++
EXECUTION_STATE SetThreadExecutionState(
  [in] EXECUTION_STATE esFlags
);
```

| Value      | Flag                 | Description                                                                                                                                         |
| ---------- | -------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0x00000040 | ES_AWAYMODE_REQUIRED | AWAYMODE를 사용하도록 설정 (**ES_CONTINUOUS** 지정해야 함).<br>컴퓨터가 절전 모드인 것처럼 보이는 동안 데스크톱 컴퓨터에서 중요한 백그라운드 처리를 수행해야 하는 미디어 녹화 및 미디어 배포 애플리케이션에서만 어웨이 모드를 사용해야 함. |
| 0x80000000 | ES_CONTINUOUS        | **ES_CONTINUOUS** 사용하고 다른 상태 플래그 중 하나를 사용하는 다음 호출이 지워지게 될 때까지 설정되는 상태가 계속 적용되도록 시스템에 알릴 수 있음.                                                       |
| 0x00000002 | ES_DISPLAY_REQUIRED  | 디스플레이 유휴 타이머를 다시 설정하여 디스플레이가 켜지도록 함.                                                                                                                |
| 0x00000001 | ES_SYSTEM_REQUIRED   | 시스템 유휴 타이머를 다시 설정하여 시스템이 작동 상태가 되도록 함.                                                                                                              |
| 0x00000004 | ES_USER_PRESENT      | 이 값은 지원되지 않음.<br>**ES_USER_PRESENT** 다른 _esFlags_ 값과 결합되면 호출이 실패.                                                                                   |

### Example

```c++
# 다음 ZwSetThreadExecutionState 호출까지 시스템은 절전모드로 전환되지 않음.
ZwSetThreadExecutionState(ES_CONTINUOUS|ES_SYSTEM_REQUIRED, &old_state);
```